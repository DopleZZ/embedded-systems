#set page(margin: (top: 2cm, bottom: 2cm, left: 2.5cm, right: 2cm))
#set text(font: "Times New Roman", size: 12pt)
#set par(justify: true, leading: 1.4em)
#set heading(numbering: "1.")
#show heading.where(level: 1): it => block[
  #v(1em)
  #text(16pt, weight: "bold")[#it.numbering #it.body]
  #v(0.4em)
]
#show heading.where(level: 2): it => block[
  #v(0.6em)
  #text(14pt, weight: "bold")[#it.numbering #it.body]
  #v(0.3em)
]

#align(center)[
  #text(20pt, weight: "bold")[Архитектура системы «Фитокуб»]
  #v(0.8em)
  #text(12pt)[Техническое описание]
]

#v(2em)

#outline(title: [Содержание], depth: 2)

#pagebreak()

= Введение

Система #strong[«Фитокуб»] предназначена для интеллектуального ухода за комнатными растениями. Устройство на базе #strong[ESP32] анализирует состояние окружающей среды при помощи датчиков и управляет поливом через помпу и реле. Пользователь наблюдает данные в веб-приложении, где отображаются актуальные параметры растения и история измерений.

Основная идея проекта — создать «умную оболочку» для горшка с растением, которая поддерживает оптимальные условия роста, уведомляет пользователя при отклонениях и позволяет удалённо управлять оборудованием.

= Общая архитектура системы

Высокоуровневая архитектура объединяет устройство, облачную инфраструктуру и клиентские приложения. Все взаимодействия происходят через MQTT-брокер и защищённые интерфейсы backend-сервиса.

#figure(
  image("arch.png", width: 14cm),
  caption: [Рисунок 1 — Общая архитектура системы «Фитокуб».],
)

== Основные элементы взаимодействия

- Устройство ESP32 собирает телеметрию и реагирует на команды управления.
- MQTT Broker обеспечивает двусторонний обмен сообщениями между устройством и сервером.
- Backend-сервис выполняет обработку данных, хранение в БД и выдачу API.
- Веб-клиент отображает состояние растений, предоставляет историю показаний и отправляет команды.

= Компоненты системы

== Устройство (ESP32)

- Управляет реле и помпой полива.
- Считывает данные с датчиков #strong[BME280] и датчика влажности почвы.
- Периодически публикует телеметрию в топик.
- Подписывается на команды из топика.
- Поддерживает локальные сценарии (например, экстренное отключение насоса при переполнении).

== MQTT Broker

- Ведёт учёт подключений для мониторинга доступности устройств.

== Backend (Java + Spring Boot)

- Получает телеметрию от брокера через MQTT-consumer и валидацию сообщений.
- Сохраняет данные в #strong[PostgreSQL].
- Отправляет команды устройствам через MQTT-publisher и подтверждает доставку.
- Обеспечивает REST и WebSocket API для пользовательских клиентов.
- Реализует аутентификацию и авторизацию пользователей.

== Frontend (React)

- Показывает Dashboard состояния растений и графики истории измерений.
- Получает обновления по WebSocket / SSE.
- Позволяет управлять устройствами: запуск полива, настройка порогов и расписаний.
- Инициирует процессы привязки и открепления устройств.

== Database (PostgreSQL)

- Хранит сущности телеметрию, данные пользователей и их устройства.

= Эксплуатация и развитие

Система ведёт журнал подключений устройств, отображает остаток воды и время работы помпы.
Планируется расширение функциональности за счёт автоматического подбора
режимов освещения и интеграции с голосовыми ассистентами.
